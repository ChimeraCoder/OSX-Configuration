" Options
set runtimepath=/Users/j/.pentadactyl
set defsearch=duckduckgo
set editor='/opt/scripts/mvim -f'
set scrollsteps=1
set newtab=all
set hlfind
set incfind
set wildmode=list:longest,full
set noerrorbells
set novisualbell
javascript dactyl.beep = function() { return false; }

colorscheme vimium

" Provides search engine results from suggestengine:
" set complete+='S' 
set complete=location,suggestion,bookmark

" Commands

" smart reload
command! smartReload -js <<EOF
if (buffer.URL.spec.indexOf('#') >= 0) {
    dactyl.execute("reload");
} else {
    dactyl.open(buffer.URL.spec);
}
EOF
nmap r :smartReload<CR>

command! editrc viewsource! /Users/j/.pentadactylrc
command! humangui set gui=navigation
command! nohumangui set gui=nonavigation

" reload .pentadactylrc
command! fresh -description "Reload .pentadactylrc file" source $HOME/.pentadactylrc

" Bookmarklets

nmap <Leader>b :bml-
nmap <Leader>s :bml-subscribe<CR>

command! bml-pocket -description "Bookmarklet: Save to pocket." open javascript:(function(){ISRIL_H='67f0';PKT_D='getpocket.com';ISRIL_SCRIPT=document.createElement('SCRIPT');ISRIL_SCRIPT.type='text/javascript';ISRIL_SCRIPT.src='http://'+PKT_D+'/b/r.js';document.getElementsByTagName('head')[0].appendChild(ISRIL_SCRIPT)})();
command! bml-mendeley -description "Bookmarklet: Save to Mendeley." open javascript:document.getElementsByTagName('body')[0].appendChild(document.createElement('script')).setAttribute('src','http://www.mendeley.com/minified/bookmarklet.js');
command! bml-twitter -description "Bookmarklet: Share on Twitter" open javascript:(function(){window.twttr=window.twttr||{};var%20D=550,A=450,C=screen.height,B=screen.width,H=Math.round((B/2)-(D/2)),G=0,F=document,E;if(C>A){G=Math.round((C/2)-(A/2))}window.twttr.shareWin=window.open('http://twitter.com/share','','left='+H+',top='+G+',width='+D+',height='+A+',personalbar=0,toolbar=0,scrollbars=1,resizable=1');E=F.createElement('script');E.src='http://platform.twitter.com/bookmarklets/share.js?v=1';F.getElementsByTagName('head')[0].appendChild(E)}());
command! bml-translate -description "Bookmarklet: Translate any page with the simple click" open javascript:(function(){var%20s%20=%20document.createElement('script');%20s.type%20=%20'text/javascript';%20s.src%20=%20'http://labs.microsofttranslator.com/bookmarklet/default.aspx?f=js&to=en';%20document.body.insertBefore(s,%20document.body.firstChild);})()
command! bml-subscribe -description "Bookmarklet: Subscribe using Google reader" open javascript:var%20b=document.body;var%20GR________bookmarklet_domain='http://www.google.com';if(b&&!document.xmlVersion){void(z=document.createElement('script'));void(z.src='http://www.google.com/reader/ui/subscribe-bookmarklet.js');void(b.appendChild(z));}else{location='http://www.google.com/reader/view/feed/'+encodeURIComponent(location.href)}
command! bml-subscribe -description "Bookmarklet: Add to Amazon wishlist" open javascript:(function(){var%20w=window,l=w.location,d=w.document,s=d.createElement('script'),e=encodeURIComponent,o='object',n='AUWLBook',u='https://www.amazon.com/wishlist/add',r='readyState',T=setTimeout,a='setAttribute',g=function(){d[r]&&d[r]!='complete'?T(g,200):!w[n]?(s[a]('charset','UTF-8'),s[a]('src',u+'.js?loc='+e(l)),d.body.appendChild(s),f()):f()},f=function(){!w[n]?T(f,200):w[n].showPopover()};typeof%20s!=o?l.href=u+'?u='+e(l)+'&t='+e(d.title):g()}())

" Qmarks
"qmark t https://twitter.com


" Messing with the passkey situation
set passkeys+='duckduckgo.com':jkhvrsm!/<C-Enter>
set passkeys+='facebook.com':<CR>
set passkeys+='twitter.com':jk<Space>/.frtmn?ghrpu<Return>
set passkeys+='www.tumblr.com':jkroae<CR>,gi
set passkeys+='www.google.com/voice':r
set passkeys+='www.google.com/calendar':dwmxajkcnqetp?<Del>s12345<Return>
set passkeys+='www.google.com/reader':jAkmvr,ga,ge
set passkeys+='www.google.com/search':jk
set passkeys+='mail.google.com':jkucxarI\/,gi,gs,gt,gd,ga,gc,gb,gk,gl<CR>

set strictfocus='google.com':laissez-faire,'chrome:*':laissez-faire,*:moderate

map <S-Esc> <pass-all-keys>
" banish ff search
if config.OS.isMacOSX
    nmap -builtin <A-g> <S-M-e>
else
    nmap -builtin <A-g> <S-C-e>
end

" Does this not work?:
autocmd LocationChange .* js modes.passAllKeys = /workflowy\.com/.test(buffer.URL)

" vim: set ft=vim
